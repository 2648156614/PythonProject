{% extends "base.html" %}

{% block title %}图片管理 - 管理员{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">图片管理</h2>
        <div>
            <a href="{{ url_for('admin_manage_problems') }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> 返回题目管理
            </a>
            <a href="{{ url_for('admin_add_problem') }}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> 添加题目
            </a>
        </div>
    </div>

    <div class="row">
        {% if images %}
            {% for image in images %}
            <div class="col-md-4 col-lg-3 mb-4">
                <div class="card">
                    <div class="card-img-top text-center p-3">
                        <img src="/static/images/{{ image.filename }}"
                             alt="{{ image.filename }}"
                             class="img-fluid"
                             style="max-height: 150px; object-fit: contain;">
                    </div>
                    <div class="card-body">
                        <h6 class="card-title small text-truncate" title="{{ image.filename }}">
                            {{ image.filename }}
                        </h6>
                        <div class="small text-muted">
                            <div>大小: {{ image.size }} KB</div>
                            <div>修改: {{ image.modified }}</div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="btn-group w-100">
                            <button type="button" class="btn btn-sm btn-outline-primary"
                                    onclick="copyImagePath('{{ image.filename }}')">
                                <i class="bi bi-clipboard"></i> 路径
                            </button>
                            <a href="/admin/delete_image/{{ image.filename }}"
                               class="btn btn-sm btn-outline-danger"
                               onclick="return confirm('确定要删除图片 {{ image.filename }} 吗？')">
                                <i class="bi bi-trash"></i> 删除
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="col-12">
                <div class="text-center py-5">
                    <i class="bi bi-images display-1 text-muted"></i>
                    <h4 class="text-muted">暂无图片</h4>
                    <p class="text-muted">还没有上传任何图片</p>
                    <a href="{{ url_for('admin_add_problem') }}" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i> 去添加题目并上传图片
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<script>
function copyImagePath(filename) {
    const path = `/static/images/${filename}`;
    navigator.clipboard.writeText(path).then(function() {
        alert('图片路径已复制到剪贴板: ' + path);
    }, function(err) {
        console.error('复制失败: ', err);
        // 降级方案
        const textArea = document.createElement("textarea");
        textArea.value = path;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand("copy");
        document.body.removeChild(textArea);
        alert('图片路径已复制到剪贴板: ' + path);
    });
}
</script>

<style>
.card-img-top {
    background-color: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
}
.card-title {
    font-size: 0.85rem;
}
</style>
{% endblock %}